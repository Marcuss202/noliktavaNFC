<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Dashboard</title>
  {% load static %}
  <link rel="stylesheet" href="{% static 'css/admin_dashboard.css' %}">
</head>
<body>
  <aside class="sidebar">
    <a class="brand" href="/">NFC Admin</a>
    <div class="menu">
      <a href="#" class="active">Dashboard</a>
      <a href="#inventory">Inventory</a>
      <a href="#sales">Sales</a>
      <a href="#purchases">Purchases</a>
      <a href="#reports">Reports</a>
      <a href="#settings">Settings</a>
    </div>
  </aside>
  <main class="content">
    <div class="topbar">
      <div>
        <div class="muted">Admin only</div>
        <h1 style="margin:4px 0 0;font-size:22px">Control Center</h1>
      </div>
      <div id="topActions"></div>
    </div>

    <div class="card" id="summary">
      <h2>Overview</h2>
      <div class="muted">Loading user…</div>
    </div>

    <div class="card" id="inventory">
      <h2>Inventory</h2>
      <div class="muted">Placeholder for stock table.</div>
    </div>
    <div class="card" id="sales">
      <h2>Sales</h2>
      <div class="muted">Placeholder for sales metrics.</div>
    </div>
    <div class="card" id="purchases">
      <h2>Purchases</h2>
      <div class="muted">Placeholder for purchase orders.</div>
    </div>
    <div class="card" id="reports">
      <h2>Reports</h2>
      <div class="muted">Placeholder for downloadable reports.</div>
    </div>
    <div class="card" id="settings">
      <h2>Settings</h2>
      <div class="muted">Configure store and permissions.</div>
    </div>
  </main>

  <script>
    const TOKEN_KEY = 'jwt_access';
    const summary = document.getElementById('summary');
    const topActions = document.getElementById('topActions');
    const menuLinks = document.querySelectorAll('.menu a');

    function clearTokens(){ localStorage.removeItem(TOKEN_KEY); localStorage.removeItem('jwt_refresh'); }

    async function fetchMe(){
      const token = localStorage.getItem(TOKEN_KEY);
      if(!token) return null;
      const res = await fetch('/api/auth/me',{ headers:{ Authorization:`Bearer ${token}` }});
      if(res.ok) return res.json();
      clearTokens();
      return null;
    }

    function renderForbidden(){
      summary.innerHTML = '<h2>Access denied</h2><div class="muted">Admins only. Redirecting…</div>';
      setTimeout(()=>{ window.location.href = '/login'; }, 1200);
    }

    function renderUser(user){
      summary.innerHTML = `<h2>Overview</h2><div class="muted">Signed in as ${user.name || user.email}</div>`;
      topActions.innerHTML = `
        <a class="pill" href="/">Store</a>
        <span class="muted" style="margin-right:8px">${user.name}</span>
        <button class="pill" id="logoutBtn">Logout</button>
      `;
      document.getElementById('logoutBtn').onclick = ()=>{ clearTokens(); window.location.href = '/login'; };
    }

    menuLinks.forEach(link=>{
      link.addEventListener('click', (e)=>{
        e.preventDefault();
        menuLinks.forEach(l=>l.classList.remove('active'));
        link.classList.add('active');
      });
    });

    (async ()=>{
      const me = await fetchMe();
      if(!me || !me.is_staff){ renderForbidden(); return; }
      renderUser(me);
    })();
  </script>
</body>
</html>
